{
  "calcite_plan": {
    "error_view": {
      "rels": [
        {
          "id": 0,
          "relOp": "LogicalTableScan",
          "table": [
            "schema",
            "feldera_error_table"
          ],
          "inputs": []
        }
      ]
    },
    "fibonacci": {
      "rels": [
        {
          "id": 1,
          "relOp": "LogicalValues",
          "type": [
            {
              "type": "INTEGER",
              "nullable": false,
              "name": "n"
            },
            {
              "type": "INTEGER",
              "nullable": false,
              "name": "value"
            }
          ],
          "tuples": [
            [
              {
                "literal": 0,
                "type": {
                  "type": "INTEGER",
                  "nullable": false
                }
              },
              {
                "literal": 0,
                "type": {
                  "type": "INTEGER",
                  "nullable": false
                }
              }
            ],
            [
              {
                "literal": 1,
                "type": {
                  "type": "INTEGER",
                  "nullable": false
                }
              },
              {
                "literal": 1,
                "type": {
                  "type": "INTEGER",
                  "nullable": false
                }
              }
            ]
          ],
          "inputs": []
        },
        {
          "id": 2,
          "relOp": "LogicalTableScan",
          "table": [
            "schema",
            "fibonacci-decl"
          ],
          "inputs": []
        },
        {
          "id": 3,
          "relOp": "LogicalFilter",
          "condition": {
            "pos": {
              "line": 20,
              "column": 27,
              "end_line": 20,
              "end_column": 37
            },
            "op": {
              "name": "<",
              "kind": "LESS_THAN",
              "syntax": "BINARY"
            },
            "operands": [
              {
                "input": 0,
                "name": "$0"
              },
              {
                "literal": 10,
                "type": {
                  "type": "INTEGER",
                  "nullable": false
                }
              }
            ]
          },
          "inputs": [
            2
          ]
        },
        {
          "id": 4,
          "relOp": "LogicalProject",
          "fields": [
            "n",
            "value",
            "$f2"
          ],
          "exprs": [
            {
              "input": 0,
              "name": "$0"
            },
            {
              "input": 1,
              "name": "$1"
            },
            {
              "pos": {
                "line": 19,
                "column": 17,
                "end_line": 19,
                "end_column": 26
              },
              "op": {
                "name": "-",
                "kind": "CHECKED_MINUS",
                "syntax": "BINARY"
              },
              "operands": [
                {
                  "input": 0,
                  "name": "$0"
                },
                {
                  "literal": 1,
                  "type": {
                    "type": "INTEGER",
                    "nullable": false
                  }
                }
              ]
            }
          ],
          "inputs": [
            2
          ]
        },
        {
          "id": 5,
          "relOp": "LogicalFilter",
          "condition": {
            "pos": {
              "line": 20,
              "column": 11,
              "end_line": 20,
              "end_column": 21
            },
            "op": {
              "name": "<",
              "kind": "LESS_THAN",
              "syntax": "BINARY"
            },
            "operands": [
              {
                "input": 0,
                "name": "$0"
              },
              {
                "literal": 10,
                "type": {
                  "type": "INTEGER",
                  "nullable": false
                }
              }
            ]
          },
          "inputs": [
            4
          ]
        },
        {
          "id": 6,
          "relOp": "LogicalJoin",
          "condition": {
            "pos": {
              "line": 19,
              "column": 8,
              "end_line": 19,
              "end_column": 26
            },
            "op": {
              "name": "=",
              "kind": "EQUALS",
              "syntax": "BINARY"
            },
            "operands": [
              {
                "input": 0,
                "name": "$0"
              },
              {
                "input": 4,
                "name": "$4"
              }
            ]
          },
          "joinType": "inner",
          "inputs": [
            3,
            5
          ]
        },
        {
          "id": 7,
          "relOp": "LogicalProject",
          "fields": [
            "n0",
            "value0",
            "$f2",
            "n",
            "value"
          ],
          "exprs": [
            {
              "input": 2,
              "name": "$2"
            },
            {
              "input": 3,
              "name": "$3"
            },
            {
              "input": 4,
              "name": "$4"
            },
            {
              "input": 0,
              "name": "$0"
            },
            {
              "input": 1,
              "name": "$1"
            }
          ],
          "inputs": [
            6
          ]
        },
        {
          "id": 8,
          "relOp": "LogicalProject",
          "fields": [
            "n",
            "value",
            "n0",
            "value0"
          ],
          "exprs": [
            {
              "input": 0,
              "name": "$0"
            },
            {
              "input": 1,
              "name": "$1"
            },
            {
              "input": 3,
              "name": "$3"
            },
            {
              "input": 4,
              "name": "$4"
            }
          ],
          "inputs": [
            7
          ]
        },
        {
          "id": 9,
          "relOp": "LogicalProject",
          "fields": [
            "n",
            "value"
          ],
          "exprs": [
            {
              "pos": {
                "line": 15,
                "column": 9,
                "end_line": 15,
                "end_column": 18
              },
              "op": {
                "name": "+",
                "kind": "CHECKED_PLUS",
                "syntax": "BINARY"
              },
              "operands": [
                {
                  "input": 2,
                  "name": "$2"
                },
                {
                  "literal": 1,
                  "type": {
                    "type": "INTEGER",
                    "nullable": false
                  }
                }
              ]
            },
            {
              "pos": {
                "line": 16,
                "column": 9,
                "end_line": 16,
                "end_column": 33
              },
              "op": {
                "name": "+",
                "kind": "CHECKED_PLUS",
                "syntax": "BINARY"
              },
              "operands": [
                {
                  "input": 3,
                  "name": "$3"
                },
                {
                  "input": 1,
                  "name": "$1"
                }
              ]
            }
          ],
          "inputs": [
            8
          ]
        },
        {
          "id": 10,
          "relOp": "LogicalUnion",
          "all": true,
          "inputs": [
            1,
            9
          ]
        }
      ]
    }
  },
  "mir": {
    "s0": {
      "operation": "constant",
      "inputs": [],
      "calcite": {
        "partial": 0
      },
      "positions": [],
      "persistent_id": "dabdc0517fb639de8ebd480cb4350e3b2054b584a8c9c42515f268f99294f72c"
    }, "s1": {
      "operation": "constant",
      "inputs": [],
      "calcite": {
        "final": 1
      },
      "positions": [],
      "persistent_id": "62ce603a01af7e712aaebdd9b81c3691b1293c14071e805d8aabe46b3d659d74"
    }, "s2": {
      "operation": "nested",
      "outputs": [
        { "node": "s8", "output": 0 }
      ],
      "s3": {
        "operation": "Z",
        "inputs": [],
        "table": "fibonacci-decl",
        "backedges": [{ "node": "s8", "output": 0 }],
        "calcite": {
          "final": 2
        },
        "positions": [],
        "persistent_id": "1cad9022fb9400950c4b4a4d9aaf96ca4433f989b896a5147b0e3335d900fe21"
      },
      "s4": {
        "operation": "flat_map_index",
        "inputs": [
          { "node": "s3", "output": 0 }
        ],
        "calcite": {
          "seq": [
            {
              "final": 3
            },{
              "partial": 6
            }]
        },
        "positions": [
          {"start_line_number":19,"start_column":8,"end_line_number":19,"end_column":26},
          {"start_line_number":20,"start_column":27,"end_line_number":20,"end_column":37}
        ],
        "persistent_id": "eea1fb749f276517f2ad1171fc00a889b629d190a675d1cff0ad8f04db1e6a22"
      },
      "s5": {
        "operation": "flat_map_index",
        "inputs": [
          { "node": "s3", "output": 0 }
        ],
        "calcite": {
          "seq": [
            {
              "final": 4
            },{
              "final": 5
            },{
              "partial": 6
            }]
        },
        "positions": [
          {"start_line_number":19,"start_column":17,"end_line_number":19,"end_column":26},
          {"start_line_number":20,"start_column":11,"end_line_number":20,"end_column":21}
        ],
        "persistent_id": "532b61244e3f6ecac6e439489956f24fb4bdfedc3708b4dd7601e06c20c5ffc2"
      },
      "s6": {
        "operation": "delta0",
        "inputs": [
          { "node": "s1", "output": 0 }
        ],
        "calcite": {
          "final": 10
        },
        "positions": [],
        "persistent_id": "af7a20a52ece7365a3b1440e05c39292ac5a55c6c641581b350a01ef95f65dc8"
      },
      "s7": {
        "operation": "join",
        "inputs": [
          { "node": "s4", "output": 0 },
          { "node": "s5", "output": 0 }
        ],
        "calcite": {
          "partial": 6
        },
        "positions": [
          {"start_line_number":15,"start_column":9,"end_line_number":15,"end_column":18},
          {"start_line_number":16,"start_column":9,"end_line_number":16,"end_column":33},
          {"start_line_number":19,"start_column":8,"end_line_number":19,"end_column":26}
        ],
        "persistent_id": "d2d417d4519df7cdda5f1b3418fbfdb6b8fd0a9bd9f9b890d0631e73a66cca5a"
      },
      "s8": {
        "operation": "sum",
        "inputs": [
          { "node": "s6", "output": 0 },
          { "node": "s7", "output": 0 }
        ],
        "calcite": {
          "final": 10
        },
        "positions": [],
        "persistent_id": "2f8076b543c6c81cf65784aee26bc1ce6ea646ada4c0be4625030c4f561b1413"
      }
    }, "s9": {
      "operation": "inspect",
      "inputs": [
        { "node": "s2", "output": 0 }
      ],
      "view": "fibonacci",
      "calcite": {
        "final": 10
      },
      "positions": [
        {"start_line_number":4,"start_column":1,"end_line_number":21,"end_column":1},
        {"start_line_number":4,"start_column":1,"end_line_number":21,"end_column":1}
      ],
      "persistent_id": "54fa67f4bb42d34f5476863b19a23ce73c84d18ce7911f8c9f59d056e5d9c994"
    }, "s10": {
      "operation": "inspect",
      "inputs": [
        { "node": "s0", "output": 0 }
      ],
      "view": "error_view",
      "calcite": {
        "final": 0
      },
      "positions": [],
      "persistent_id": "42bb786d35654abe048f3d4cedb08308c085b652304d4902765d81d8afda529c"
    }
  },
  "sources": [
    "DECLARE RECURSIVE view fibonacci(n INT, value INT);",
    "create table input (x int);",
    "",
    "create view fibonacci AS",
    "(",
    "    -- Base case: first two Fibonacci numbers",
    "    select 0 as n, 0 as value",
    "    union all",
    "    select 1 as n, 1 as value",
    ")",
    "union all",
    "(",
    "    -- Compute F(n)=F(n-1)+F(n-2)",
    "    select",
    "        prev.n + 1 as n,",
    "        (prev.value + curr.value) as value",
    "    from fibonacci as curr",
    "    join fibonacci as prev",
    "    on prev.n = curr.n - 1",
    "    where curr.n < 10 and prev.n < 10",
    ");"
  ]
}