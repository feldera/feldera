{
  "title": "Warehouse",
  "description": "Use case of a warehouse that stores product items which are bought and sold.",
  "prefix": "warehouse-",
  "steps": [
    {
      "name": "setup",
      "entities": [
        {
          "type": "program",
          "name": "program",
          "body": {
            "description": "Warehouse program",
            "code": "-- Product\nCREATE TABLE product (\n    id INT PRIMARY KEY,\n    name VARCHAR NOT NULL,\n    description VARCHAR NOT NULL\n);\n\n-- Each item is of a certain product\nCREATE TABLE item (\n    id INT PRIMARY KEY,\n    product_id INT NOT NULL,\n    manufactured_at TIMESTAMP NOT NULL,\n    bought_at TIMESTAMP NOT NULL,\n    sold_at TIMESTAMP\n);\n\n-- Total number of products\nCREATE VIEW product_count AS\n    SELECT COUNT(*) AS num_products FROM product;\n\n-- Total number of items\nCREATE VIEW item_count AS\n    SELECT COUNT(*) AS num_items FROM item;\n\n-- For each product, count the number of items\nCREATE VIEW items_per_product AS\n    SELECT product.id AS product_id, product.name AS product_name, COUNT(*) AS num_items\n    FROM product LEFT JOIN item ON product.id = item.product_id\n    GROUP BY (product.id, product.name);\n"
          }
        },
        {
          "type": "connector",
          "name": "product-in",
          "body": {
            "description": "Warehouse URL input connector for product table",
            "config": {
              "transport": {
                "name": "url",
                "config": {
                  "path": "https://raw.githubusercontent.com/feldera/feldera/canned-demo-warehouse/demo/demos/warehouse/data-product.json"
                }
              },
              "format": {
                "name": "json",
                "config": {
                  "update_format": "insert_delete",
                  "array": false
                }
              }
            }
          }
        },
        {
          "type": "connector",
          "name": "item-in",
          "body": {
            "description": "Warehouse URL input connector for item table",
            "config": {
              "transport": {
                "name": "url",
                "config": {
                  "path": "https://raw.githubusercontent.com/feldera/feldera/canned-demo-warehouse/demo/demos/warehouse/data-item.json"
                }
              },
              "format": {
                "name": "json",
                "config": {
                  "update_format": "insert_delete",
                  "array": false
                }
              }
            }
          }
        },
        {
          "type": "pipeline",
          "name": "pipeline",
          "body": {
            "description": "Warehouse pipeline",
            "config": {"workers": 6},
            "program_name": "program",
            "connectors": [
              {
                "connector_name": "product-in",
                "is_input": true,
                "name": "product-in",
                "relation_name": "PRODUCT"
              },
              {
                "connector_name": "item-in",
                "is_input": true,
                "name": "item-in",
                "relation_name": "ITEM"
              }
            ]
          }
        }
      ]
    }
  ]
}
