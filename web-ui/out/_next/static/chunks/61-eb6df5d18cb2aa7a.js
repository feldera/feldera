"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[61],{613:function(e,t,n){var i=n(5893),r=n(7294),o=n(7918),a=n(2734),l=n(5812);let s=r.forwardRef((e,t)=>{let{sx:n,skin:r,color:s}=e,c=(0,a.Z)(),d={default:{color:c.palette.primary.main,backgroundColor:(0,l.E)(c.palette.primary.main,.16)},primary:{color:c.palette.primary.main,backgroundColor:(0,l.E)(c.palette.primary.main,.16)},secondary:{color:c.palette.secondary.main,backgroundColor:(0,l.E)(c.palette.secondary.main,.16)},success:{color:c.palette.success.main,backgroundColor:(0,l.E)(c.palette.success.main,.16)},error:{color:c.palette.error.main,backgroundColor:(0,l.E)(c.palette.error.main,.16)},warning:{color:c.palette.warning.main,backgroundColor:(0,l.E)(c.palette.warning.main,.16)},info:{color:c.palette.info.main,backgroundColor:(0,l.E)(c.palette.info.main,.16)}},u={...e,ref:t};return u.rounded=void 0,(0,i.jsx)(o.Z,{...u,variant:"filled",className:"MuiChip-rounded MuiChip-light",sx:"light"===r&&s?Object.assign(d[s],n):n})});t.Z=s},9415:function(e,t,n){var i=n(5893),r=n(613),o=n(4386),a=n(1334),l=n(8264);let s=e=>{let t=(0,i.jsx)(l.Z,{}),n=(0,i.jsx)(a.Z,{});switch(e){case"isDebouncing":case"isSaving":case"isModified":return n;case"isNew":case"isUpToDate":return t}},c=e=>{let t=e.stateToLabel(e.state),n="isUpToDate"===e.state?"Everything saved to cloud":"";return(0,i.jsx)(o.Z,{title:n,children:(0,i.jsx)(r.Z,{label:t,skin:"light",sx:{mr:2},icon:s(e.state),id:e.id})})};t.Z=c},8639:function(e,t,n){var i=n(5893),r=n(7294),o=n(6242),a=n(7987),l=n(3527),s=n(9429),c=n(4386),d=n(3946),u=n(1954),p=n(9461);let h=e=>{let{setRows:t,fetchRows:n,onUpdateRow:h,onDeleteRow:m,onEditClicked:x,tableProps:g,addActions:f}=e,[j,y]=(0,r.useState)(7),[b,v]=(0,r.useState)(""),[Z,w]=(0,r.useState)([]),{isLoading:C,isError:N,data:S,error:P}=n;f&&g.columns.push({flex:.1,minWidth:90,sortable:!1,field:"actions",headerName:"Actions",renderCell:e=>(0,i.jsxs)(i.Fragment,{children:[x&&(0,i.jsx)(c.Z,{title:"Edit",children:(0,i.jsx)(d.Z,{size:"small",onClick:t=>{t.preventDefault(),x(e.row)},children:(0,i.jsx)(u.JO,{icon:"bx:pencil",fontSize:20})})}),m&&(0,i.jsx)(c.Z,{title:"Delete",children:(0,i.jsx)(d.Z,{size:"small",onClick:()=>m(e.row),children:(0,i.jsx)(u.JO,{icon:"bx:trash-alt",fontSize:20})})})]})}),(0,r.useEffect)(()=>{C||N||t(S)},[C,N,S,t]);let k=e=>{if(v(e),0==e.length){w([]);return}let t=RegExp((0,s.hr)(e),"i");if(!C&&!N){let e=S.filter(e=>Object.keys(e).some(n=>{if(null!==e[n])return t.test(e[n].toString())}));w(e)}};return(0,i.jsx)(o.Z,{children:(0,i.jsx)(a.s,{...g,autoHeight:!0,experimentalFeatures:{newEditingApi:!0},apiRef:e.apiRef,components:{Toolbar:p.Z,ErrorOverlay:l.f},rows:Z.length?Z:g.rows,pageSize:j,rowsPerPageOptions:[7,10,25,50],onPageSizeChange:e=>y(e),processRowUpdate:h,error:P,loading:C,componentsProps:{baseButton:{variant:"outlined"},toolbar:{hasSearch:e.hasSearch,hasFilter:e.hasFilter,value:b,clearSearch:()=>k(""),onChange:e=>k(e.target.value)},errorOverlay:{isError:N,error:P}}})})};t.Z=h},3527:function(e,t,n){n.d(t,{f:function(){return a}});var i=n(5893),r=n(6901),o=n(2401);let a=e=>e.isError?(0,i.jsxs)(r.Z,{severity:"error",children:[(0,i.jsx)(o.Z,{children:"Error"}),"Can't display programs: ",(0,i.jsx)("strong",{children:e.error.message}),(0,i.jsx)("br",{}),"Check network connectivity, then try to refresh the page. ."]}):(0,i.jsx)(i.Fragment,{})},9461:function(e,t,n){var i=n(5893),r=n(7357),o=n(135),a=n(3946),l=n(853),s=n(1954);let c=e=>(0,i.jsxs)(r.Z,{sx:{gap:2,display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between",p:e=>e.spacing(2,6,4,6)},children:[e.hasFilter&&(0,i.jsx)(l.M,{}),e.hasSearch&&(0,i.jsx)(o.Z,{size:"small",value:e.value,onChange:e.onChange,placeholder:"Searchâ€¦",InputProps:{startAdornment:(0,i.jsx)(r.Z,{sx:{mr:2,display:"flex"},children:(0,i.jsx)(s.JO,{icon:"bx:search",fontSize:20})}),endAdornment:(0,i.jsx)(a.Z,{size:"small",title:"Clear","aria-label":"Clear",onClick:e.clearSearch,children:(0,i.jsx)(s.JO,{icon:"bx:x",fontSize:20})})},sx:{width:{xs:1,sm:"auto"},"& .MuiInputBase-root > svg":{mr:2}}})]});t.Z=c},9541:function(e,t,n){var i=n(5893),r=n(6886);let o=e=>{let{title:t,subtitle:n}=e;return(0,i.jsxs)(r.ZP,{item:!0,xs:12,children:[t,n]})};t.Z=o},61:function(e,t,n){n.r(t),n.d(t,{PipelineWithProvider:function(){return e$},default:function(){return eG}});var i=n(5893),r=n(8838),o=n.n(r),a=n(7294),l=n(6886),s=n(5861),c=n(9541),d=n(6242),u=n(4267),p=n(9071),h=n(3599),m=n(9429);let x=e=>e.nodeInternals.size+e.edges.length,g=e=>Array.from(e.nodeInternals.values()).every(e=>e.width&&e.height);function f(){let e=(0,p.oR)(x),t=(0,p.oR)(g),{getNodes:n,setNodes:i,getEdges:r}=(0,p._K)();return(0,a.useCallback)(()=>{e&&t&&function(e,t,n){var i,r;let a=e(),l=a.filter(e=>"sqlPlaceholder"===e.type||"sqlProgram"===e.type);o()(1===l.length);let s=a.filter(e=>"inputNode"===e.type),c=new Map;(null===(i=l[0].data)||void 0===i?void 0:null===(r=i.program)||void 0===r?void 0:r.schema)&&l[0].data.program.schema.inputs.forEach((e,t)=>{c.set(e.name,t)});let d=(function(e,t,n){let i=e.filter(e=>t.some(t=>t.source===e.id)),r=e.map((e,t)=>({node:e,index:t})).filter(e=>t.every(t=>t.source!==e.node.id)).reduce((e,t)=>({...e,[t.index]:t.node}),{});i.sort((e,i)=>{let r=(0,p.my)([e],t),a=(0,p.my)([i],t);o()(1===r.length),o()(1===a.length),o()(r[0].targetHandle&&a[0].targetHandle);let l=(0,m.Qm)(r[0].targetHandle,"table-"),s=(0,m.Qm)(a[0].targetHandle,"table-");o()(l&&s);let c=n.get(l),d=n.get(s);return o()(void 0!==c&&void 0!==d),c-d});let a=[],l=0;for(let t=0;t<e.length;t++)r[t]?a.push(e[t]):(a.push(i[l]),l++);return a})(s,n(),c).concat(a.filter(e=>"inputPlaceholder"===e.id)),u=a.filter(e=>"outputNode"===e.type||"outputPlaceholder"===e.id).sort((e,t)=>e.position.y-t.position.y),h=d.filter(e=>"inputNode"===e.type).map(e=>(e.height||0)+20).reduce((e,t)=>e+t,0),x=u.filter(e=>"outputNode"===e.type).map(e=>(e.height||0)+20).reduce((e,t)=>e+t,0),g=d.map(e=>e.width||0).reduce((e,t)=>Math.max(e,t),0),f=l.map(e=>e.width||0).reduce((e,t)=>Math.max(e,t),0),j=l.map(e=>e.height||0).reduce((e,t)=>Math.max(e,t),0),y=200-(g+f/2+180),b=200-f/2,v=200+f/2+180,Z=Math.max(h,x,j),w=0,C=d.map((e,t)=>(0==t?w=Z/2-h/2:w+=(d[t-1].height||0)+20,{...e,position:{x:y+(g-(e.width||0)),y:w}})),N=0,S=u.map((e,t)=>(0==t?N=Z/2-x/2:N+=(u[t-1].height||0)+20,{...e,position:{x:v,y:N}}));t(e=>{let t=e.filter(e=>"sqlPlaceholder"===e.type||"sqlProgram"===e.type).map(e=>"sqlPlaceholder"===e.type||"sqlProgram"===e.type?{...e,position:{x:b,y:Z/2-(e.height||0)/2}}:e).concat(C).concat(S);return t})}(n,i,r)},[e,t,n,i,r])}var j=function(){let e=f();(0,a.useEffect)(()=>{e()},[e])},y=n(4218),b=n(6829),v=n(3445);let Z=(0,v.Ue)()(e=>({isOpen:!1,forNodes:"inputNode",close:()=>e(()=>({isOpen:!1})),open:t=>{e({isOpen:!0,forNodes:t})}}));var w=function(e){let t=Z(),{getNode:n}=(0,p._K)(),i=()=>{let i=n(e);if(!i)return;let r="inputPlaceholder"===i.id?"inputNode":"outputNode";t.open(r)};return i},C=n(1954);let N=e=>{let{id:t,data:n}=e,r=w(t);return(0,i.jsx)(ei,{onClick:r,children:(0,i.jsxs)(u.Z,{sx:{textAlign:"center"},children:[(0,i.jsx)(C.JO,{icon:n.icon,fontSize:"2rem"}),(0,i.jsx)(s.Z,{variant:"h6",children:n.label})]})})};var S=(0,a.memo)(N),P=n(5306),k=n(135),_=n(7848),E=n(3293);let T=(0,v.Ue)(e=>({saveState:"isUpToDate",project:void 0,name:"",description:"",config:"",setName:t=>e({name:t}),setDescription:t=>e({description:t}),setSaveState:t=>e({saveState:t}),setProject:t=>e({project:t}),setConfig:t=>e({config:t})}));var O=function(){let e=T(e=>e.setSaveState),t=(0,a.useCallback)(()=>{e("isDebouncing")},[e]);return t},I=n(5945);function A(){let{getNode:e,setNodes:t}=(0,p._K)(),n=(0,a.useCallback)(n=>{console.log(n);let i=e("sql");i&&t(e=>e.map(e=>e.id===i.id&&"sqlPlaceholder"===e.type?{...e,width:void 0,height:void 0,type:"sqlProgram",data:{label:n.name,program:n}}:"sql"===e.type?{...e,type:"sqlProgram",data:{label:n.name,program:n}}:e))},[e,t]);return n}var U=function(e){let{getNode:t}=(0,p._K)(),n=O(),i=A(),r=T(e=>e.setProject),o=(0,I.NL)(),l=(0,a.useCallback)((o,a)=>{let l=t(e);l&&(r(a),i(a),n())},[t,e,o,i,n,r]);return l};let D=e=>{let[t,n]=(0,a.useState)([]),r=U(e.id),o=(e,n)=>{let i=t.find(e=>e.name==n);void 0!=i&&r(e,i)},{isLoading:l,isError:c,data:d}=(0,_.a)(["project"]);return(0,a.useEffect)(()=>{l||c||n(d.filter(e=>e.schema).map(E.S))},[l,c,d]),(0,i.jsx)(ei,{children:(0,i.jsxs)(u.Z,{sx:{textAlign:"center","& svg":{mb:2}},children:[(0,i.jsx)(C.JO,{icon:e.data.icon,fontSize:"2rem"}),(0,i.jsx)(s.Z,{variant:"h6",sx:{mb:4},children:e.data.label}),(0,i.jsx)(P.Z,{id:"sql-program-select","z-index":20,onInputChange:o,disableCloseOnSelect:!0,options:t.map(e=>e.name),getOptionLabel:e=>e,renderInput:e=>(0,i.jsx)(k.Z,{...e,className:"nodrag",label:"Program",placeholder:"Select SQL..."})})]})})};var K=(0,a.memo)(D),z=n(8445),F=n(9661),q=n(7357),M=n(3946),L=function(e){let{addNodes:t,getNode:n,deleteElements:i,getEdges:r}=(0,p._K)(),o=O(),l=T(e=>e.setProject),s=(0,a.useCallback)(()=>{let a=n(e);if(!a)return;let s="sqlProgram"===a.type;s&&l(void 0),a.hidden=!0;let c=setTimeout(()=>{i({nodes:[a]}),s&&(i({edges:r()}),o());let e=s?[{...eP,width:void 0,height:void 0,position:a.position}]:[];e.length>0&&t(e)},50);return()=>clearTimeout(c)},[n,e,i,t,r,o,l]);return s},H=n(1110);let J=e=>{let{id:t,data:n}=e,{getNode:r,getEdges:o,deleteElements:a}=(0,p._K)(),l=L(t),s=e=>{if(e.source){let t=r(e.source);if(void 0!==t){let e=(0,p.my)([t],o());a({nodes:[],edges:e})}}if(!e.target)return!1;{let t=r(e.target);return void 0!==t&&"sqlProgram"===t.type&&null!=e.targetHandle&&e.targetHandle.startsWith("table-")}};return(0,i.jsxs)(en,{children:[(0,i.jsx)(z.Z,{title:n.connector.name,subheader:n.connector.description,sx:{py:5,alignItems:"flex-start"},titleTypographyProps:{variant:"h5"},subheaderTypographyProps:{variant:"body1",sx:{color:"text.disabled"}},avatar:(0,i.jsx)(F.Z,{sx:{mt:1.5,width:42,height:42},children:(0,i.jsx)(C.JO,{icon:(0,H.Pb)(n.connector.typ)})}),action:(0,i.jsx)(q.Z,{sx:{display:"flex",alignItems:"center",mt:-4,mr:-4},className:"nodrag nopan",children:(0,i.jsx)(M.Z,{size:"small","aria-label":"close",sx:{color:"text.secondary"},onClick:()=>l(),children:(0,i.jsx)(C.JO,{icon:"bx:x",fontSize:20})})})}),(0,i.jsx)(et,{className:"inputHandle",type:"source",position:p.Ly.Right,isConnectable:!0,isValidConnection:s})]})},R=e=>{let{id:t,data:n}=e,{getNode:r}=(0,p._K)(),o=L(t),a=e=>{if(!e.source)return!1;{let t=r(e.source);return void 0!==t&&"sqlProgram"===t.type&&null!=e.sourceHandle&&e.sourceHandle.startsWith("view-")}};return(0,i.jsxs)(en,{children:[(0,i.jsx)(z.Z,{title:n.connector.name,subheader:n.connector.description,sx:{py:5,alignItems:"flex-start"},titleTypographyProps:{variant:"h5"},subheaderTypographyProps:{variant:"body1",sx:{color:"text.disabled"}},avatar:(0,i.jsx)(F.Z,{sx:{mt:1.5,width:42,height:42},children:(0,i.jsx)(C.JO,{icon:(0,H.Pb)(n.connector.typ)})}),action:(0,i.jsx)(q.Z,{sx:{display:"flex",alignItems:"center",mt:-4,mr:-4},className:"nodrag nopan",children:(0,i.jsx)(M.Z,{size:"small","aria-label":"close",sx:{color:"text.secondary"},onClick:()=>o(),children:(0,i.jsx)(C.JO,{icon:"bx:x",fontSize:20})})})}),(0,i.jsx)(et,{className:"outputHandle",type:"target",position:p.Ly.Left,isConnectable:!0,isValidConnection:a})]})};var W=n(1536),Q=n(7918);function V(e){let{getNode:t,getEdges:n}=(0,p._K)(),r=e=>{if(!e.source)return!1;{let i=t(e.source);if(!i)return!1;let r=(0,p.my)([i],n()).length>0;return void 0!==i&&!r&&"inputNode"===i.type}};return(0,i.jsxs)(q.Z,{sx:{ml:-6,mt:3},style:{position:"relative"},children:[(0,i.jsx)(Q.Z,{sx:{ml:9},label:e.name,color:"secondary",avatar:(0,i.jsx)(F.Z,{children:(0,i.jsx)(C.JO,{fontSize:16,icon:"mdi:database-import"})})}),(0,i.jsx)(et,{className:"tableHandle",id:"table-"+e.name,type:"target",position:p.Ly.Left,isConnectable:!0,isValidConnection:r})]})}function $(e){let{getNode:t}=(0,p._K)(),n=e=>{if(!e.target)return!1;{let n=t(e.target);return void 0!==n&&"outputNode"===n.type}};return(0,i.jsxs)(q.Z,{sx:{mr:-6,mt:3,textAlign:"right"},style:{position:"relative"},children:[(0,i.jsx)(Q.Z,{sx:{mr:9},label:e.name,color:"secondary",avatar:(0,i.jsx)(F.Z,{children:(0,i.jsx)(C.JO,{fontSize:16,icon:"mdi:database-export"})})}),(0,i.jsx)(et,{id:"view-"+e.name,type:"source",position:p.Ly.Right,isConnectable:!0,isValidConnection:n})]})}var B=(0,a.memo)(function(e){let{id:t,data:n}=e,r=L(t);return(0,i.jsxs)(en,{children:[(0,i.jsx)(z.Z,{title:n.label,sx:{py:5,alignItems:"flex-start"},titleTypographyProps:{variant:"h4"},avatar:(0,i.jsx)(C.JO,{icon:"ant-design:console-sql-outlined",fontSize:"2rem"}),action:(0,i.jsx)(q.Z,{sx:{display:"flex",alignItems:"center"},children:(0,i.jsx)(M.Z,{size:"small","aria-label":"close",sx:{color:"text.secondary"},onClick:()=>r(),children:(0,i.jsx)(C.JO,{icon:"bx:x",fontSize:20})})})}),(0,i.jsx)(u.Z,{sx:{textAlign:"center","& svg":{mb:2}},children:(0,m.$R)(n.program.schema.inputs,n.program.schema.outputs).map((e,t)=>{let n=e[0],r=e[1];return(0,i.jsxs)(W.Z,{direction:"row",spacing:2,sx:{width:"100%"},children:[(0,i.jsx)(q.Z,{sx:{textAlign:"left"},children:n&&(0,i.jsx)(V,{name:n.name})}),(0,i.jsxs)(q.Z,{sx:{textAlign:"right",width:"100%"},children:[" ",r&&(0,i.jsx)($,{name:r.name})]})]},t)})})]})});function G(){let e=(0,y.Z)(["\n  background-color: ",";\n  border: 8px solid ",";\n  width: 35px;\n  height: 35px;\n  border-radius: 25px;\n"]);return G=function(){return e},e}function X(){let e=(0,y.Z)(["\n  box-shadow: rgba(0, 0, 0, 0.08) 0px 4px 12px;\n  text-align: center;\n  font-weight: bold;\n  color: #0984e3;\n  cursor: default;\n"]);return X=function(){return e},e}function Y(){let e=(0,y.Z)(["\n  cursor: default;\n"]);return Y=function(){return e},e}function ee(){let e=(0,y.Z)(["\n  width: 310px;\n  border: 1px dashed #bbb;\n  color: #bbb;\n  box-shadow: none;\n  cursor: pointer;\n"]);return ee=function(){return e},e}let et=(0,b.Z)(p.HH)(G(),e=>{let{theme:t}=e;return t.palette.primary.main},e=>{let{theme:t}=e;return t.palette.background.default}),en=(0,b.Z)(d.Z)(X());(0,b.Z)(q.Z)(Y());let ei=(0,b.Z)(d.Z)(ee());var er={ioPlaceholder:S,inputNode:J,outputNode:R,sqlPlaceholder:K,sqlProgram:B};function eo(){let e=(0,y.Z)(["\n  fill: none;\n  stroke-width: 5;\n  stroke: ",";\n"]);return eo=function(){return e},e}let ea=b.Z.path(eo(),e=>e.theme.palette.secondary.main);var el={inspectableEdge:function(e){let{id:t,sourceX:n,sourceY:r,targetX:o,targetY:a,sourcePosition:l,targetPosition:s,markerEnd:c}=e,[d,u,h]=(0,p.OQ)({sourceX:n,sourceY:r,sourcePosition:l,targetX:o,targetY:a,targetPosition:s});return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ea,{id:t,d:d,markerEnd:c}),(0,i.jsx)("g",{transform:"translate(".concat(u,", ").concat(h,")")})]})}},es=n(7533),ec=n(948),ed=n(7958),eu=n(3321),ep=n(2963),eh=n(3795),em=n(7838);function ex(e,t){return(console.log("connectorConnects",e,t),e.direction===em.Nm.INPUT)?t.inputs.some(t=>t.name===e.config):t.outputs.some(t=>t.name===e.config)}function eg(){let{setNodes:e,getNodes:t,getNode:n,addNodes:i,addEdges:r}=(0,p._K)(),o=f(),l=(0,a.useCallback)((a,l)=>{let s=l.direction===em.Nm.INPUT?"inputNode":"outputNode",c=l.direction===em.Nm.INPUT?"inputPlaceholder":"outputPlaceholder",d=n(c);if(!d)return;let u=t().find(e=>e.id===l.uuid);if(u)return;e(e=>e.map(e=>e.id===c?{...e,position:{x:d.position.x,y:d.position.y+120}}:e)),i({position:{x:d.position.x,y:d.position.y},id:l.uuid,type:s,deletable:!0,data:{connector:a,ac:l}}),o();let h=n("sql"),x=n(l.uuid),g=l.config,f=l.direction===em.Nm.INPUT?"table-":"view-",j=f+g,y=""!=l.config;if(y&&h&&x){let e=(0,p.my)([h,x],[]).find(e=>e.targetHandle===j||e.sourceHandle===j);if(!e){let e=l.direction===em.Nm.INPUT?l.uuid:"sql",t=l.direction===em.Nm.INPUT?"sql":l.uuid,n=l.direction===em.Nm.INPUT?null:j,i=l.direction===em.Nm.INPUT?j:null;r({id:(0,m.O1)(),source:e,target:t,sourceHandle:n,targetHandle:i})}}},[n,t,e,i,r,o]);return l}var ef=n(8639);let ej=e=>{let[t,n]=(0,a.useState)([]),r=(0,_.a)({queryKey:["connector"]}),o={density:"compact",getRowId:e=>e.connector_id,columnVisibilityModel:{connector_id:!1,typ:!1},columns:[{flex:.05,minWidth:50,field:"connector_id",headerName:"ID"},{flex:.3,minWidth:290,headerName:"Name",field:"name"},{flex:.15,minWidth:140,field:"typ",headerName:"Type"},{flex:.1,minWidth:90,sortable:!1,field:"actions",headerName:"",renderCell:t=>(0,i.jsx)(eu.Z,{size:"small",variant:"outlined",color:"secondary",onClick:()=>e.onAddClick(t.row),children:"Add"})}],rows:t.filter(t=>t.direction===e.direction||t.direction===em.Nm.INPUT_OUTPUT),hideFooter:!0,initialState:{filter:{filterModel:{items:[{id:1,columnField:"typ",operatorValue:"equals",value:e.typ}]}}}};return(0,i.jsx)(d.Z,{sx:{color:"secondary.main",m:5},children:(0,i.jsx)(ef.Z,{tableProps:o,setRows:n,fetchRows:r,hasFilter:!1,addActions:!1})})};var ey=n(1009),eb=n(9280),ev=n(4765);let eZ=(0,ec.ZP)(q.Z)(e=>{let{theme:t}=e;return{display:"flex",alignItems:"center",padding:t.spacing(3,4),justifyContent:"space-between",backgroundColor:t.palette.background.paper}}),ew=e=>{let[t,n]=(0,a.useState)(!1),r=()=>{e.closeDrawer(),n(!0)},o=0===e.howMany?"secondary":"success";return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(l.ZP,{item:!0,xs:6,children:(0,i.jsxs)(d.Z,{sx:{color:"secondary.main",m:5,display:"flex",textAlign:"center",alignItems:"center",flexDirection:"column"},children:[(0,i.jsx)(z.Z,{avatar:(0,i.jsx)(C.JO,{icon:e.icon,fontSize:"3rem"})}),(0,i.jsxs)(u.Z,{children:[(0,i.jsx)(eu.Z,{fullWidth:!0,sx:{mb:1},variant:"outlined",color:"secondary",onClick:r,children:"New"}),(0,i.jsxs)(eu.Z,{fullWidth:!0,sx:{mb:1},variant:"outlined",color:"secondary",disabled:0===e.howMany,onClick:e.openSelectTable,children:["Select\xa0",(0,i.jsx)(Q.Z,{sx:{p:0,m:0},label:e.howMany,size:"small",color:o,variant:"outlined"})]})]}),e.dialog({show:t,setShow:n,onSuccess:e.onSuccess})]})})})},eC=(e,t)=>(0,H.lU)(t)==em.Nm.INPUT_OUTPUT||e===(0,H.lU)(t),eN=()=>{let[e,t]=(0,a.useState)(),{isOpen:n,forNodes:r,close:o}=Z(),c="inputNode"===r?em.Nm.INPUT:em.Nm.OUTPUT,[d,u]=(0,a.useState)({[em.r7.KAFKA_IN]:0,[em.r7.KAFKA_OUT]:0,[em.r7.FILE]:0}),{data:p,isLoading:h,isError:x}=(0,_.a)({queryKey:["connector"]});(0,a.useEffect)(()=>{if(!h&&!x){let e=p.map(e=>e.typ).reduce((e,t)=>(e[t]+=1,e),{[em.r7.KAFKA_IN]:0,[em.r7.KAFKA_OUT]:0,[em.r7.FILE]:0});u(e)}},[p,h,x]);let g=()=>{o(),t(void 0)},f=e=>{t(e)},j=eg(),y=e=>{g();let t={uuid:(0,m.O1)(),connector_id:e.connector_id,config:"",direction:"inputNode"===r?em.Nm.INPUT:em.Nm.OUTPUT};j(e,t)};return(0,i.jsxs)(es.ZP,{id:"connector-drawer",open:n,anchor:"right",variant:"temporary",onClose:g,ModalProps:{keepMounted:!0},sx:{"& .MuiDrawer-paper":{width:{xs:300,sm:600},backgroundColor:"background.default"}},children:[(0,i.jsxs)(eZ,{children:[(0,i.jsx)(s.Z,{variant:"h6",children:(0,i.jsxs)(ep.Z,{"aria-label":"breadcrumb",separator:(0,i.jsx)(ed.Z,{fontSize:"small"}),children:[(0,i.jsx)(eh.Z,{underline:"hover",color:"inherit",onClick:()=>t(void 0),children:"inputNode"===r?"Add Input Source":"Add Output Destination"}),e&&(0,i.jsx)(s.Z,{color:"text.primary",children:(0,H.tr)(e)})]})}),(0,i.jsx)(M.Z,{size:"small",onClick:g,sx:{color:"text.primary"},children:(0,i.jsx)(C.JO,{icon:"bx:x",fontSize:20})})]}),!e&&(0,i.jsxs)(l.ZP,{container:!0,spacing:3,children:[eC(c,em.r7.KAFKA_IN)&&(0,i.jsx)(ew,{dialog:eb.a,closeDrawer:o,openSelectTable:()=>f(em.r7.KAFKA_IN),howMany:d[em.r7.KAFKA_IN],onSuccess:y,icon:"logos:kafka"}),eC(c,em.r7.KAFKA_OUT)&&(0,i.jsx)(ew,{dialog:ev.m,closeDrawer:o,openSelectTable:()=>f(em.r7.KAFKA_OUT),howMany:d[em.r7.KAFKA_OUT],onSuccess:y,icon:"logos:kafka"}),eC(c,em.r7.FILE)&&(0,i.jsx)(ew,{dialog:ey.k,closeDrawer:o,openSelectTable:()=>f(em.r7.FILE),howMany:d[em.r7.FILE],onSuccess:y,icon:"ph:file-csv"})]}),e&&(0,i.jsx)(l.ZP,{container:!0,spacing:3,children:(0,i.jsx)(l.ZP,{item:!0,xs:12,children:(0,i.jsx)(ej,{direction:c,typ:e,onAddClick:y})})})]})};n(1367);let eS={account:"paid-pro",hideAttribution:!0},eP={id:"sql",data:{label:"Select a SQL program",icon:"ant-design:console-sql-outlined"},position:{x:0,y:150},type:"sqlPlaceholder",deletable:!1},ek=[{id:"inputPlaceholder",data:{label:"Add a new Input",icon:"bx:arrow-from-left"},position:{x:-500,y:150},type:"ioPlaceholder",deletable:!1},eP,{id:"outputPlaceholder",data:{label:"Add a new Output",icon:"bx:arrow-to-right"},position:{x:500,y:150},type:"ioPlaceholder",deletable:!1}],e_=[],eE={padding:.95};function eT(){let{setEdges:e,deleteElements:t}=(0,p._K)(),n=O(),r=f();j();let o=(0,a.useRef)(!0),l=(0,a.useCallback)(()=>{o.current=!1},[]),s=(0,a.useCallback)((t,i)=>{o.current=!0,e(e=>(0,p.sN)(t,i,e)),n(),r()},[e,n,r]),c=(0,a.useCallback)((e,n)=>{o.current||t({nodes:[],edges:[n]}),o.current=!0},[t]),d=(0,a.useCallback)(()=>{n()},[n]),u=(0,a.useCallback)(e=>{e.forEach(e=>{"remove"==e.type&&n()})},[n]),m={type:"inspectableEdge",markerEnd:{type:p.QZ.ArrowClosed,width:8,height:8},animated:!0};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(p.x$,{defaultNodes:ek,defaultEdges:e_,defaultEdgeOptions:m,edgesFocusable:!0,onEdgeUpdateStart:l,onEdgeUpdate:s,onEdgeUpdateEnd:c,onEdgesChange:u,onConnect:d,proOptions:eS,fitView:!0,nodeTypes:er,edgeTypes:el,fitViewOptions:eE,minZoom:.5,maxZoom:1.5,nodesDraggable:!1,nodesConnectable:!0,zoomOnDoubleClick:!1,snapToGrid:!0,onlyRenderVisibleElements:!0,children:(0,i.jsx)(h.A,{})}),(0,i.jsx)(eN,{})]})}var eO=function(){return(0,i.jsx)(eT,{})},eI=n(9415),eA=n(1345),eU=n(4054),eD=n(6815);let eK=e=>{let t=O(),n=T(e=>e.setName),r=T(e=>e.setDescription),o=T(e=>e.name),a=T(e=>e.description),s=e=>{n(e.target.value),t()},c=e=>{r(e.target.value),t()};return(0,i.jsxs)(l.ZP,{container:!0,spacing:5,children:[(0,i.jsx)(l.ZP,{item:!0,xs:4,children:(0,i.jsxs)(eU.Z,{fullWidth:!0,children:[(0,i.jsx)(k.Z,{fullWidth:!0,id:"pipeline-name",type:"text",label:"Name",placeholder:m.C$.pipeline_name,value:o,error:Boolean(e.errors.name),onChange:s}),e.errors.name&&(0,i.jsx)(eD.Z,{sx:{color:"error.main"},id:"validation-schema-first-name",children:e.errors.name.message})]})}),(0,i.jsx)(l.ZP,{item:!0,xs:8,children:(0,i.jsx)(k.Z,{fullWidth:!0,id:"pipeline-description",type:"Description",label:"Description",placeholder:m.C$.pipeline_description,value:a,onChange:c})})]})};var ez=n(8228),eF=n(4697),eq=n(1163),eM=n(657),eL=n(7645),eH=n(6580),eJ=n(1425),eR=n(8951);let eW=e=>{let t=(0,eq.useRouter)(),n=()=>{e.setOpen(!1),t.push("/analytics/editor/".concat(e.project_id))};return(0,i.jsxs)(eM.Z,{open:e.open&&void 0!==e.project_id,disableEscapeKeyDown:!0,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",onClose:(e,t)=>{"backdropClick"!==t&&n()},children:[(0,i.jsx)(eL.Z,{id:"alert-dialog-title",children:"Missing Schema?"}),(0,i.jsx)(eH.Z,{children:(0,i.jsx)(eR.Z,{id:"alert-dialog-description",children:"We didn't find the schema for the program of the config you are trying to load. Either the program has not been compiled yet or the compilation had errors. Continue to the program editor to resolve the issue."})}),(0,i.jsx)(eJ.Z,{children:(0,i.jsx)(eu.Z,{variant:"contained",onClick:n,children:"Edit Program"})})]})};var eQ=n(6981);let eV=e=>(0,eA.EQ)(e).with("isModified",()=>"Saving ...").with("isDebouncing",()=>"Saving ...").with("isSaving",()=>"Saving ...").with("isUpToDate",()=>"Saved").with("isNew",()=>"New Pipeline").exhaustive(),e$=e=>{let t=(0,I.NL)(),[n,r]=(0,a.useState)(!1),{configId:h,setConfigId:x}=e,g=T(e=>e.setSaveState),f=T(e=>e.saveState),j=T(e=>e.name),y=T(e=>e.setName),b=T(e=>e.description),v=T(e=>e.setDescription),Z=T(e=>e.config),w=T(e=>e.setConfig),C=T(e=>e.project),N=T(e=>e.setProject),{getNode:S,getEdges:P}=(0,p._K)(),{mutate:k}=(0,ez.D)(em.E4.newConfig),{mutate:O}=(0,ez.D)(em.E4.updateConfig),U=A(),D=eg(),{pushMessage:K}=(0,eQ.Z)(),z=(0,_.a)(["project"]),F=(0,_.a)(["connector"]),q=(0,_.a)(["configStatus",{config_id:h}],{enabled:void 0!==h&&"isSaving"!==f&&"isModified"!==f&&"isDebouncing"!==f});(0,a.useEffect)(()=>{if("isSaving"!==f&&"isModified"!==f&&"isDebouncing"!==f){if(q.isLoading||q.isError||z.isLoading||z.isError||F.isLoading||F.isError)void 0===h&&(N(void 0),g("isNew"),y(""),v(""),w("workers: 8\n"));else{x(()=>q.data.config_id),y(q.data.name),v(q.data.description),w(q.data.config),g("isUpToDate");let e=q.data.attached_connectors,t=[],n=e;if(console.log(e),q.data.project_id){let i=z.data.find(e=>e.project_id===q.data.project_id);if(i){null==i.schema?r(!0):r(!1);let o=(0,E.S)(i);e&&(t=e.filter(e=>!ex(e,o.schema)),n=e.filter(e=>ex(e,o.schema))),N(o),U(o)}}t.length>0&&K({key:new Date().getTime(),color:"warning",message:"Could not attach ".concat(t.length," connector(s): No tables/views named ").concat(t.map(e=>e.config).join(", ")," found.")}),n&&n.forEach(e=>{let t=F.data.find(t=>t.connector_id===e.connector_id);t&&D(t,e)})}}},[F.isLoading,F.isError,F.data,q.isLoading,q.isError,q.data,z.isLoading,z.isError,z.data,x,y,v,w,g,N,U,D,h,K,f]);let M=(0,eF.y1)(()=>{"isDebouncing"===f&&g("isModified")},2e3);return(0,a.useEffect)(()=>{if("isDebouncing"===f&&M(),"isModified"===f){if(g("isSaving"),console.log("update existing config"),void 0===h)k({name:j,project_id:null==C?void 0:C.project_id,description:b,config:Z},{onError:e=>{K({message:e.message,key:new Date().getTime(),color:"error"}),g("isUpToDate"),console.log("error",e)},onSuccess:e=>{x(e.config_id),g("isUpToDate")}});else{let e=P().map(e=>{let t=S(e.source),n=S(e.target),i=(null==t?void 0:t.id)==="sql"?n:t,r=null==i?void 0:i.data.ac;if(void 0==r)throw Error("data.ac in an edge was undefined");let o=r.direction===em.Nm.INPUT?(0,m.Qm)(e.targetHandle||"","table-"):(0,m.Qm)(e.sourceHandle||"","view-");return r.config=o,r}),n={config_id:h,name:j,description:b,project_id:null==C?void 0:C.project_id,config:Z,connectors:e};O(n,{onSettled:()=>{o()(void 0!==h),t.invalidateQueries(["configStatus",{config_id:h}])},onError:e=>{K({message:e.message,key:new Date().getTime(),color:"error"}),g("isUpToDate")},onSuccess:()=>{t.setQueryData(["configStatus",{config_id:h}],t=>t?{...t,name:j,description:b,project_id:null==C?void 0:C.project_id,config:Z,attached_connectors:e}:t),g("isUpToDate")}})}}},[f,M,g,x,O,k,h,C,j,b,Z,S,P,K,t]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(l.ZP,{container:!0,spacing:6,className:"match-height",id:"pipeline-builder-content",children:[(0,i.jsx)(c.Z,{title:(0,i.jsx)(s.Z,{variant:"h5",children:"Pipeline Creator"}),subtitle:(0,i.jsx)(s.Z,{variant:"body2",children:"Define an end-to-end pipeline with analytics."})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,children:(0,i.jsxs)(d.Z,{children:[(0,i.jsx)(u.Z,{children:(0,i.jsx)(eK,{errors:{}})}),(0,i.jsx)(u.Z,{children:(0,i.jsx)(l.ZP,{item:!0,xs:12,children:(0,i.jsx)(eI.Z,{id:"save-indicator",stateToLabel:eV,state:f})})})]})}),(0,i.jsx)("div",{style:{width:"100vw",height:"60vh"},children:(0,i.jsx)(eO,{})})]}),(0,i.jsx)(eW,{open:n,setOpen:r,project_id:null==C?void 0:C.project_id})]})},eB=()=>{let[e,t]=(0,a.useState)(void 0);return(0,i.jsx)(p.tV,{children:(0,i.jsx)(e$,{configId:e,setConfigId:t})})};var eG=eB},3293:function(e,t,n){n.d(t,{S:function(){return i}});function i(e){return{name:e.name,project_id:e.project_id,schema:JSON.parse(e.schema||'{ "inputs": [], "outputs": [] }')}}}}]);