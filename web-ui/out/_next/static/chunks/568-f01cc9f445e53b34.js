(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[568],{8264:function(e,t,r){"use strict";var i=r(4836);t.Z=void 0;var n=i(r(4938)),a=r(5893),o=(0,n.default)((0,a.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM10 17l-3.5-3.5 1.41-1.41L10 14.17 15.18 9l1.41 1.41L10 17z"}),"CloudDone");t.Z=o},55:function(e,t,r){"use strict";var i=r(4836);t.Z=void 0;var n=i(r(4938)),a=r(5893),o=(0,n.default)((0,a.jsx)("path",{d:"M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"}),"Done");t.Z=o},2141:function(e,t,r){"use strict";var i=r(4836);t.Z=void 0;var n=i(r(4938)),a=r(5893),o=(0,n.default)((0,a.jsx)("path",{d:"M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"ErrorOutline");t.Z=o},1334:function(e,t,r){"use strict";var i=r(4836);t.Z=void 0;var n=i(r(4938)),a=r(5893),o=(0,n.default)((0,a.jsx)("path",{d:"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"}),"Sync");t.Z=o},4938:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i.createSvgIcon}});var i=r(6031)},8445:function(e,t,r){"use strict";r.d(t,{Z:function(){return C}});var i=r(3366),n=r(7462),a=r(7294),o=r(6010),s=r(4780),c=r(5861),l=r(1657),u=r(948),d=r(1588),p=r(4867);function m(e){return(0,p.Z)("MuiCardHeader",e)}let f=(0,d.Z)("MuiCardHeader",["root","avatar","action","content","title","subheader"]);var g=r(5893);let h=["action","avatar","className","component","disableTypography","subheader","subheaderTypographyProps","title","titleTypographyProps"],v=e=>{let{classes:t}=e;return(0,s.Z)({root:["root"],avatar:["avatar"],action:["action"],content:["content"],title:["title"],subheader:["subheader"]},m,t)},j=(0,u.ZP)("div",{name:"MuiCardHeader",slot:"Root",overridesResolver:(e,t)=>(0,n.Z)({[`& .${f.title}`]:t.title,[`& .${f.subheader}`]:t.subheader},t.root)})({display:"flex",alignItems:"center",padding:16}),x=(0,u.ZP)("div",{name:"MuiCardHeader",slot:"Avatar",overridesResolver:(e,t)=>t.avatar})({display:"flex",flex:"0 0 auto",marginRight:16}),b=(0,u.ZP)("div",{name:"MuiCardHeader",slot:"Action",overridesResolver:(e,t)=>t.action})({flex:"0 0 auto",alignSelf:"flex-start",marginTop:-4,marginRight:-8,marginBottom:-4}),Z=(0,u.ZP)("div",{name:"MuiCardHeader",slot:"Content",overridesResolver:(e,t)=>t.content})({flex:"1 1 auto"}),y=a.forwardRef(function(e,t){let r=(0,l.Z)({props:e,name:"MuiCardHeader"}),{action:a,avatar:s,className:u,component:d="div",disableTypography:p=!1,subheader:m,subheaderTypographyProps:f,title:y,titleTypographyProps:C}=r,w=(0,i.Z)(r,h),_=(0,n.Z)({},r,{component:d,disableTypography:p}),S=v(_),E=y;null==E||E.type===c.Z||p||(E=(0,g.jsx)(c.Z,(0,n.Z)({variant:s?"body2":"h5",className:S.title,component:"span",display:"block"},C,{children:E})));let M=m;return null==M||M.type===c.Z||p||(M=(0,g.jsx)(c.Z,(0,n.Z)({variant:s?"body2":"body1",className:S.subheader,color:"text.secondary",component:"span",display:"block"},f,{children:M}))),(0,g.jsxs)(j,(0,n.Z)({className:(0,o.Z)(S.root,u),as:d,ref:t,ownerState:_},w,{children:[s&&(0,g.jsx)(x,{className:S.avatar,ownerState:_,children:s}),(0,g.jsxs)(Z,{className:S.content,ownerState:_,children:[E,M]}),a&&(0,g.jsx)(b,{className:S.action,ownerState:_,children:a})]}))});var C=y},613:function(e,t,r){"use strict";var i=r(5893),n=r(7294),a=r(7918),o=r(2734),s=r(5812);let c=n.forwardRef((e,t)=>{let{sx:r,skin:n,color:c}=e,l=(0,o.Z)(),u={default:{color:l.palette.primary.main,backgroundColor:(0,s.E)(l.palette.primary.main,.16)},primary:{color:l.palette.primary.main,backgroundColor:(0,s.E)(l.palette.primary.main,.16)},secondary:{color:l.palette.secondary.main,backgroundColor:(0,s.E)(l.palette.secondary.main,.16)},success:{color:l.palette.success.main,backgroundColor:(0,s.E)(l.palette.success.main,.16)},error:{color:l.palette.error.main,backgroundColor:(0,s.E)(l.palette.error.main,.16)},warning:{color:l.palette.warning.main,backgroundColor:(0,s.E)(l.palette.warning.main,.16)},info:{color:l.palette.info.main,backgroundColor:(0,s.E)(l.palette.info.main,.16)}},d={...e,ref:t};return d.rounded=void 0,(0,i.jsx)(a.Z,{...d,variant:"filled",className:"MuiChip-rounded MuiChip-light",sx:"light"===n&&c?Object.assign(u[c],r):r})});t.Z=c},4568:function(e,t,r){"use strict";r.d(t,{Z:function(){return U}});var i=r(5893),n=r(7294),a=r(6886),o=r(5861),s=r(135),c=r(7720),l=r(6815),u=r(2734),d=r(6242),p=r(8445),m=r(4267),f=r(4054),g=r(5945),h=r(8228),v=r(7848),j=r(9541),x=r(3764),b=r(1345),Z=r(4697),y=r(6981),C=r(8570),w=r(8456),_=r(4386),S=r(55),E=r(2141),M=r(613);let P=e=>{let t="Success",r="Compiling ...",n=(0,i.jsx)(w.Z,{color:"inherit",size:"1rem"}),a=(0,i.jsx)(S.Z,{}),o=(0,i.jsx)(E.Z,{}),s=(0,b.EQ)(e.state).with({SqlError:b.P.select()},e=>({visible:!0,color:"error",isCompiling:!1,label:e.length+" Compiler Error",toolTip:"Compilation had "+e.length+" "+(e.length>1?"errors":"error")+", check highlighted lines in the editor for more details."})).with({RustError:b.P._},()=>({visible:!0,color:"success",isCompiling:!1,label:t})).with({SystemError:b.P._},()=>({visible:!0,color:"success",isCompiling:!1,label:t})).with("None",()=>({visible:!1,color:"warning",isCompiling:!1,label:r})).with("Pending",()=>({visible:!0,color:"warning",isCompiling:!0,label:r})).with("CompilingSql",()=>({visible:!0,color:"warning",isCompiling:!0,label:r})).with("CompilingRust",()=>({visible:!0,color:"success",isCompiling:!1,label:t})).with("Success",()=>({visible:!0,color:"success",isCompiling:!1,label:t})).exhaustive();return s.visible?(0,i.jsx)(_.Z,{title:s.toolTip,children:(0,i.jsx)(M.Z,{id:e.id,sx:{mr:1},label:s.label,skin:"light",color:s.color,icon:s.isCompiling?n:"error"==s.color?o:a})}):(0,i.jsx)(i.Fragment,{})};var D=r(9415),k=r(9429),N=r(3915);let T=e=>{let t=(0,Z.y1)(()=>{e.setState("isModified")},2e3),r=r=>{e.setProject(e=>({...e,name:r.target.value})),e.setState("isDebouncing"),t()},n=r=>{e.setProject(e=>({...e,description:r.target.value})),e.setState("isDebouncing"),t()};return(0,i.jsxs)(a.ZP,{container:!0,spacing:5,children:[(0,i.jsx)(a.ZP,{item:!0,xs:4,children:(0,i.jsxs)(f.Z,{fullWidth:!0,children:[(0,i.jsx)(s.Z,{id:"program-name",fullWidth:!0,type:"text",label:"Name",placeholder:k.C$.program_name,value:e.project.name,error:Boolean(e.errors.name),onChange:r}),e.errors.name&&(0,i.jsx)(l.Z,{sx:{color:"error.main"},id:"validation-schema-first-name",children:e.errors.name.message})]})}),(0,i.jsx)(a.ZP,{item:!0,xs:8,children:(0,i.jsx)(s.Z,{fullWidth:!0,id:"program-description",type:"Description",label:"Description",placeholder:k.C$.program_description,value:e.project.description,onChange:n})})]})},L=e=>(0,b.EQ)(e).with("isNew",()=>"New Project").with("isDebouncing",()=>"Saving ...").with("isModified",()=>"Saving ...").with("isSaving",()=>"Saving ...").with("isUpToDate",()=>"Saved").exhaustive(),R=(e,t,r,i,a)=>{let o=(0,g.NL)(),{pushMessage:s}=(0,y.Z)(),{mutate:c}=(0,h.D)(C.Y.newProject);(0,n.useEffect)(()=>{null==t.project_id&&"isModified"===e&&c({name:t.name,description:t.description,code:t.code},{onSettled:()=>{o.invalidateQueries(["project"]),o.invalidateQueries(["projectStatus",{project_id:t.project_id}])},onSuccess:e=>{r(t=>({...t,version:e.version,project_id:e.project_id})),""===t.name&&a({name:{message:"Enter a name for the project."}}),i("isUpToDate"),a({})},onError:e=>{e.message.includes("name already exists")?(a({name:{message:"This name already exists. Enter a different name."}}),i("isDebouncing")):s({message:e.message,key:new Date().getTime(),color:"error"})}})},[t.project_id,c,t.code,t.description,t.name,e,s,a,r,i,o])},Q=(e,t,r,i,a)=>{let o=(0,v.a)(["projectCode",{project_id:e.project_id}],{enabled:null!=e.project_id});(0,n.useEffect)(()=>{!o.data||o.isLoading||o.isError||(t({project_id:o.data.project.project_id,name:o.data.project.name,description:o.data.project.description,status:o.data.project.status,version:o.data.project.version,code:o.data.code}),o.data.project.version>i&&"None"!==o.data.project.status&&a(o.data.project.version),r("isUpToDate"))},[o.isLoading,o.isError,o.data,i,t,r,a])},q=(e,t,r,i,a)=>{let o=(0,g.NL)(),{pushMessage:s}=(0,y.Z)(),{mutate:c,isLoading:l}=(0,h.D)(C.Y.updateProject);(0,n.useEffect)(()=>{if(null!==t.project_id&&"isModified"===e&&!l){let e={project_id:t.project_id,name:t.name,description:t.description,code:t.code};c(e,{onSettled:()=>{o.invalidateQueries(["project"]),o.invalidateQueries(["projectCode",{project_id:t.project_id}]),o.invalidateQueries(["projectStatus",{project_id:t.project_id}])},onSuccess:t=>{(0,N.q)(o,e),r(e=>({...e,version:t.version})),i("isUpToDate"),a({})},onError:e=>{e.message.includes("name already exists")?(a({name:{message:"This name already exists. Enter a different name."}}),i("isDebouncing")):s({message:e.message,key:new Date().getTime(),color:"error"})}})}},[c,e,t.project_id,t.description,t.name,t.code,i,l,o,s,a,r])},z=(e,t,r,i)=>{let a=(0,g.NL)(),{pushMessage:o}=(0,y.Z)(),{mutate:s,isLoading:c,isError:l}=(0,h.D)(C.Y.compileProject);(0,n.useEffect)(()=>{c||l||"isUpToDate"!=e||null===t.project_id||!(t.version>i)||"Pending"===t.status||"CompilingSql"===t.status||(r(e=>({...e,status:"Pending"})),s({project_id:t.project_id,version:t.version},{onSettled:()=>{a.invalidateQueries(["project"]),a.invalidateQueries(["projectStatus",{project_id:t.project_id}])},onError:e=>{r(e=>({...e,status:"None"})),o({message:e.message,key:new Date().getTime(),color:"error"})}}))},[s,c,l,e,t.project_id,t.version,t.status,i,a,o,r])},B=(e,t,r)=>{let i=(0,g.NL)(),a=(0,v.a)({queryKey:["projectStatus",{project_id:e.project_id}],refetchInterval:e=>(void 0===e||"Pending"===e.status||"CompilingSql"===e.status)&&1e3,enabled:null!==e.project_id&&("Pending"===e.status||"CompilingSql"===e.status)});(0,n.useEffect)(()=>{!a.data||a.isLoading||a.isError||((0,b.EQ)(a.data.status).with({SqlError:b.P.select()},()=>{r(e.version)}).with({RustError:b.P.select()},()=>{r(e.version)}).with({SystemError:b.P.select()},()=>{r(e.version)}).with("Pending",()=>{}).with("CompilingSql",()=>{}).with("CompilingRust",()=>{r(e.version)}).with("Success",()=>{r(e.version)}).with("None",()=>{}).exhaustive(),e.status!==a.data.status&&(t(e=>({...e,status:a.data.status})),i.setQueryData(["projectStatus",{project_id:e.project_id}],a.data),i.setQueryData(["project"],t=>null==t?void 0:t.map(t=>t.project_id===e.project_id?a.data:t))))},[a.data,a.isLoading,a.isError,e.status,e.version,e.project_id,r,t,i])},A=(e,t)=>{let r=(0,x.Ik)();(0,n.useEffect)(()=>{null!==r&&null!==t.current&&(0,b.EQ)(e.status).with({SqlError:b.P.select()},e=>{let i=e.map(e=>({startLineNumber:e.startLineNumber,endLineNumber:e.endLineNumber,startColumn:e.startColumn,endColumn:e.endColumn+1,message:e.message,severity:e.warning?r.MarkerSeverity.Warning:r.MarkerSeverity.Error}));r.editor.setModelMarkers(t.current.getModel(),"sql-errors",i)}).otherwise(()=>{r.editor.setModelMarkers(t.current.getModel(),"sql-errors",[])})},[r,e.status,t])},H=e=>{let t=(0,u.Z)(),[r,s]=(0,n.useState)(0),[l,f]=(0,n.useState)(e.program.project_id?"isNew":"isUpToDate"),[g,h]=(0,n.useState)(e.program),[v,b]=(0,n.useState)({}),y="dark"===t.palette.mode?"vs-dark":"vs";R(l,g,h,f,b),Q(g,h,f,r,s),q(l,g,h,f,b),z(l,g,h,r),B(g,h,s);let C=(0,n.useRef)(null),w=(0,Z.y1)(()=>{f("isModified")},2e3),_=e=>{h(t=>({...t,code:e||""})),f("isDebouncing"),w()};return A(g,C),(0,i.jsxs)(a.ZP,{container:!0,spacing:6,children:[(0,i.jsx)(j.Z,{title:(0,i.jsx)(o.Z,{variant:"h5",children:"SQL Editor"}),subtitle:(0,i.jsx)(o.Z,{variant:"body2",children:"Define your analytics and data transformations."})}),(0,i.jsx)(a.ZP,{item:!0,xs:12,children:(0,i.jsxs)(d.Z,{children:[(0,i.jsx)(p.Z,{title:"SQL Code"}),(0,i.jsx)(m.Z,{children:(0,i.jsx)(T,{project:g,setProject:h,setState:f,errors:v})}),(0,i.jsx)(m.Z,{children:(0,i.jsxs)(a.ZP,{item:!0,xs:12,children:[(0,i.jsx)(D.Z,{id:"save-indicator",stateToLabel:L,state:l}),(0,i.jsx)(P,{id:"compile-indicator",state:g.status})]})}),(0,i.jsx)(m.Z,{id:"editor-content",children:(0,i.jsx)(x.ZP,{height:"60vh",theme:y,defaultLanguage:"sql",value:g.code,onChange:_,onMount:e=>{C.current=e}})}),(0,i.jsx)(c.Z,{sx:{m:"0 !important"}})]})})]})};var U=H},9415:function(e,t,r){"use strict";var i=r(5893),n=r(613),a=r(4386),o=r(1334),s=r(8264);let c=e=>{let t=(0,i.jsx)(s.Z,{}),r=(0,i.jsx)(o.Z,{});switch(e){case"isDebouncing":case"isSaving":case"isModified":return r;case"isNew":case"isUpToDate":return t}},l=e=>{let t=e.stateToLabel(e.state),r="isUpToDate"===e.state?"Everything saved to cloud":"";return(0,i.jsx)(a.Z,{title:r,children:(0,i.jsx)(n.Z,{label:t,skin:"light",sx:{mr:2},icon:c(e.state),id:e.id})})};t.Z=l},9541:function(e,t,r){"use strict";var i=r(5893),n=r(6886);let a=e=>{let{title:t,subtitle:r}=e;return(0,i.jsxs)(n.ZP,{item:!0,xs:12,children:[t,r]})};t.Z=a},9429:function(e,t,r){"use strict";r.d(t,{$R:function(){return s},C$:function(){return c},O1:function(){return a},Qm:function(){return o},hr:function(){return i},ob:function(){return n}});let i=e=>e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");function n(e){if(1024>Math.abs(e))return e+" B";let t=["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],r=-1;do e/=1024,++r;while(Math.abs(e)>=1024&&r<t.length-1);return e.toFixed(1)+" "+t[r]}let a=()=>new Date().getTime().toString(36)+Math.random().toString(36).slice(2),o=(e,t)=>e.startsWith(t)?e.slice(t.length):e,s=(e,t)=>Array.from(Array(Math.max(t.length,e.length)),(r,i)=>[e[i],t[i]]),c={program_name:"Average Price Calculator",program_description:"Calculate the average price of a product",connector_name:"House Price Data",connector_description:"House price data from the UK Land Registry",pipeline_name:"Price Checker",pipeline_description:"Analyze e-commerce prices"}},4697:function(e,t,r){"use strict";r.d(t,{y1:function(){return n}});var i=r(7294);function n(e,t,r){var n=this,a=(0,i.useRef)(null),o=(0,i.useRef)(0),s=(0,i.useRef)(null),c=(0,i.useRef)([]),l=(0,i.useRef)(),u=(0,i.useRef)(),d=(0,i.useRef)(e),p=(0,i.useRef)(!0);(0,i.useEffect)(function(){d.current=e},[e]);var m=!t&&0!==t&&"undefined"!=typeof window;if("function"!=typeof e)throw TypeError("Expected a function");t=+t||0;var f=!!(r=r||{}).leading,g=!("trailing"in r)||!!r.trailing,h="maxWait"in r,v=h?Math.max(+r.maxWait||0,t):null;return(0,i.useEffect)(function(){return p.current=!0,function(){p.current=!1}},[]),(0,i.useMemo)(function(){var e=function(e){var t=c.current,r=l.current;return c.current=l.current=null,o.current=e,u.current=d.current.apply(r,t)},r=function(e,t){m&&cancelAnimationFrame(s.current),s.current=m?requestAnimationFrame(e):setTimeout(e,t)},i=function(e){if(!p.current)return!1;var r=e-a.current;return!a.current||r>=t||r<0||h&&e-o.current>=v},j=function(t){return s.current=null,g&&c.current?e(t):(c.current=l.current=null,u.current)},x=function e(){var n=Date.now();if(i(n))return j(n);if(p.current){var s=t-(n-a.current);r(e,h?Math.min(s,v-(n-o.current)):s)}},b=function(){var d=Date.now(),m=i(d);if(c.current=[].slice.call(arguments),l.current=n,a.current=d,m){if(!s.current&&p.current)return o.current=a.current,r(x,t),f?e(a.current):u.current;if(h)return r(x,t),e(a.current)}return s.current||r(x,t),u.current};return b.cancel=function(){s.current&&(m?cancelAnimationFrame(s.current):clearTimeout(s.current)),o.current=0,c.current=a.current=l.current=s.current=null},b.isPending=function(){return!!s.current},b.flush=function(){return s.current?j(Date.now()):u.current},b},[f,h,t,v,g,m])}},4836:function(e){e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports}}]);